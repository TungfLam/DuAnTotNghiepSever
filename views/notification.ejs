<%- include('./inc/top') %>

    <div class=" d-flex">
        <div class="row p-3" style=" background-color: white;
             border-radius: 13px; 
              box-shadow: 0px 0px 10px 0px rgba(0, 0, 0, 0.4);
               margin: 20px; 
               width: 40%;
              height: 550px;
                ">

            <form id="myForm">
                <div class="text-center">
                    <p class="fs-2 fw-bold">Thông báo</p>
                </div>
                <div class="mb-3">
                    <label for="inputTitle" class="inputTitle">Tiêu đề:</label>
                    <input type="text" class="form-control" id="inputTitle" placeholder="Nhập tiêu đề" required>
                </div>
                <div class="mb-3">
                    <label for="inputContent" class="inputContent">Nội dung:</label>
                    <textarea class="form-control" id="inputContent" rows="3" placeholder="Nhập nội dung" required></textarea>
                </div>
                <div class="mb-3">
                    <label for="inputImage" class="inputImage">Link ảnh:</label>
                    <input type="text" class="form-control" id="inputImage" placeholder="Nhập link ảnh">
                </div>
                <div class="d-grid gap-2">
                    <button style="height: 48px;" onclick="clickPushNotification()" class="btn btn-primary">Gửi thông báo</button>
                </div>
            </form>
        </div>



        <div class="row p-3"
            style=" background-color: white; border-radius: 13px;  box-shadow: 0px 0px 10px 0px rgba(0, 0, 0, 0.4); margin: 20px; width: 60%;">
            <div class="text-center">
                <p class="fs-2 fw-bold">Người dùng</p>
            </div>

            <div class="col-12">
                <nav class="navbar">
                    <div class="container justify-content-end">
                        <form class="d-flex" role="search" action="/notification">
                            <input class="form-control me-2 boderBtn" type="search" placeholder="Search"
                                aria-label="Search" style="width: 300px;" name="search" value="<%= search %>">
                                <button style="height: 40px; width: 120px;" type="submit" class="btn btn-primary">Tìm kiếm</button>
                        </form>
                    </div>
                </nav>
            </div>
            <table id="example" class="table  table-hover " style="width:100%;">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>SĐT</th>
                        <th>Họ và tên</th>
                        <th>
                            <div class="form-check mb-2 custom-checkbox">
                                <input style="width: 1.8em;height: 1.8em;"
                                    type="checkbox" id="masterCheckbox">
                            </div>
                        </th>
                    </tr>
                </thead>

                <% if (listUser.length===0) { %>
                    <tr>
                        <td colspan="7" style="text-align: center;justify-content: center;">
                            <p>Dữ liệu không tồn tại.</p>
                        </td>
                    </tr>
                    <% } else { %>

                        <% for (let i=0; i < listUser.length; i++) { %>
                            <% const row=listUser[i]; %>
                                <tr>

                                    <td>
                                        <%= i+1 %>
                                    </td>
                                    <td>
                                        <%= row.phone_number %>
                                    </td>
                                    <td>
                                        <%= row.full_name %>
                                    </td>
                                    <td>
                                        <div class="form-check mb-3 custom-checkbox">
                                            <input style="width: 1.6em;height: 1.6em;" class="checkboxItem"
                                                type="checkbox" id="<%= row.token %>">
                                        </div>
                                    </td>

                                </tr>
                                <% } %>
                            <% } %>

            </table>
        </div>
    </div>

    <script>
        function clickPushNotification(){
            const textTitle = document.getElementById('inputTitle').value;
            const textContent = document.getElementById('inputContent').value;
            const textImage = document.getElementById('inputImage').value;

            fetch('http://localhost:6868/notification' ,{
                method: 'POST',
                headers: 
                {
                    'Content-Type': 'application/json',
                },
                body : JSON.stringify({
                    listToken : listTokenUser,
                    title : textTitle,
                    content : textContent,
                    textImage : textImage,
                })
            }).then(response => response.json())
            .then(data => {
                console(data);
            })
            .catch(error => {
                console.log(error);
            });
        }
    </script>

<script>
    let listTokenUser = [];

    const masterCheckbox = document.getElementById('masterCheckbox');
    const checkboxItems = document.querySelectorAll('.checkboxItem');

    masterCheckbox.addEventListener('change' , function (checkbox){
        listTokenUser = [];
        checkboxItems.forEach(function (checkboxItem){
            checkboxItem.checked = masterCheckbox.checked;
            if(masterCheckbox.checked){
                if(checkboxItem.id == "") return;
                listTokenUser.push(checkboxItem.id);
                console.log('id : ' + checkboxItem.id)
            }else{
                listTokenUser = listTokenUser.filter(item => item !== this.id);
            }
        });
        console.log(listTokenUser.length);
    })

    checkboxItems.forEach(function (checkbox){
        checkbox.addEventListener('change' , function (){
            masterCheckbox.checked = false;
            if(this.checked){
                if(this.id == "") return;
                listTokenUser.push(this.id);
                console.log('id : ' + this.id)
            }else{
                listTokenUser = listTokenUser.filter(item => item !== this.id);
            }
            console.log(listTokenUser.length);
        })
    })

</script>

    <%- include('./inc/bottom') %>